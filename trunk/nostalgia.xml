<?xml version="1.0" encoding="UTF-8"?>
<Module>
<ModulePrefs title="Nostalgia" height="100" author="Andreas Domfors" author_email="andreas.domfors@gmail.com">
<Require feature="google.calendar-0.5.read"/>
<Require feature="locked-domain"/>
</ModulePrefs>
  <Content type="html">
  
  <![CDATA[
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
  "http://www.w3.org/TR/html4/strict.dtd">
<html>
<body>
<script>

function run() {
var currentdate = new Date();
var startDate;
var endDate;
var offset = 1;
  startDate = {year: currentdate.getFullYear()-offset, month: currentdate.getMonth(), date : currentdate.getDay(),
                   hour : 0, minute: 0, second: 0};
  endDate = {year: currentdate.getFullYear()-offset, month: currentdate.getMonth(), date : currentday.getDay()+1,
                 hour : 0, minute: 0, second: 0};

  var calendars = 'selected';
  google.calendar.read.getEvents(makeCallback("<b>One Year Ago</b><p/>"), calendars, startDate, endDate);
  
  offset = 2;
  startDate = {year: currentdate.getFullYear()-offset, month: currentdate.getMonth(), date : currentdate.getDay(),
                   hour : 0, minute: 0, second: 0};
  endDate = {year: currentdate.getFullYear()-offset, month: currentdate.getMonth(), date : currentday.getDay()+1,
                 hour : 0, minute: 0, second: 0};  
google.calendar.read.getEvents(makeCallback("<b>Two Years Ago</b><p/>"), calendars, startDate, endDate);				 
}
function makeCallback(header) {
	function eventCallback(response) {
	  var out = header;
	  for (var i = 0; i < response.length; ++i) {
		if ('error' in response[i]) {
		  out += 'Can\'t load calendar for ' + response[i].email + '\n';
		  continue;
		}

		var events = response[i]['events'];
		for(var j = 0; j < events.length; ++j) {
		  var e = events[j];
		  if ('title' in e) {
			out += '<a onclick="google.calendar.showEvent(\'' + e.id + '\')">' + e.title + '</a><p/>'
		  }
		}
	  }
	  document.write(out);
	}
	return eventCallback;
}
gadgets.util.registerOnLoadHandler(run);
</script>
</body>
</html>
  ]]></Content>
</Module>